<!DOCTYPE html>
<html>
<head>
  <title>ðŸ¤– Chat-Bot (Gemini)</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#f5f5f5; margin:0; padding:0; display:flex; justify-content:center;}
    .container { max-width:600px; width:100%; margin-top:50px; background:#fff; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.1); display:flex; flex-direction:column; height:80vh;}
    h2 { text-align:center; color:#333; margin:20px 0; }
    .chat-box { flex:1; overflow-y:auto; padding:20px; }
    .message { padding:12px; border-radius:10px; margin-bottom:15px; max-width:80%; word-wrap:break-word; }
    .user-message { background:#d1e7ff; align-self:flex-end; }
    .bot-message { background:#f0f0f0; align-self:flex-start; }
    form { display:flex; padding:10px 20px; border-top:1px solid #ddd; }
    input[name="message"] { flex:1; padding:10px; border:1px solid #ccc; border-radius:6px; font-size:16px; }
    button { padding:10px 20px; margin-left:10px; border:none; background:#4CAF50; color:white; font-size:16px; border-radius:6px; cursor:pointer; }
    button:hover { background:#45a049; }
  </style>
</head>
<body>
  <div class="container">
    <h2>ðŸ¤– Chat-Bot (Gemini)</h2>
    <div class="chat-box" id="chat-box"></div>
    <form id="chat-form">
      <input name="message" placeholder="Type your message here..." required autofocus />
      <button type="submit">Send</button>
    </form>
  </div>

  <script>
    const chatBox = document.getElementById('chat-box');
    const chatForm = document.getElementById('chat-form');
    let sessionId = localStorage.getItem("session_id") || "";

    function addMessage(role, text) {
      const div = document.createElement('div');
      div.className = 'message ' + (role === 'user' ? 'user-message' : 'bot-message');
      div.innerHTML = `<strong>${role === 'user' ? 'You' : 'Bot'}:</strong> ${text}`;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    chatForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const messageInput = chatForm.elements['message'];
      const message = messageInput.value.trim();
      if (!message) return;

      addMessage('user', message);
      messageInput.value = '';

      const formData = new FormData();
      formData.append('message', message);

      const res = await fetch('/api/chat', { method:'POST', body: formData });
      const data = await res.json();

      addMessage('bot', data.response);
      sessionId = data.session_id;
      localStorage.setItem("session_id", sessionId);
    });
  </script>
</body>
</html>